import{e as X,_ as oe,h as ce}from"./index.70bdb397.js";/* empty css              *//* empty css               */import{d as G,e as r,w as Y,r as j,aK as z,B as k,aD as V,aG as t,aH as e,aE as de,aM as v,aV as L,bL as J,aW as me,c0 as Ee,bG as ue,bH as ne,bM as _e,bx as se,c1 as Be,c2 as De,by as le,bD as ie,aN as P,C as Q,bE as he,bK as Te,aJ as xe,aI as Ae,b8 as we,b7 as Ne,c3 as Ve,aT as Ie,c as Se,u as pe,bV as $e,bN as Ke,bb as Oe,bF as ze}from"./arco.46b62ede.js";/* empty css                *//* empty css                *//* empty css              *//* empty css              *//* empty css               */import{g as Le,d as Ue,e as Re,f as qe,m as Me,q as Pe}from"./case.0ede9485.js";/* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css               *//* empty css                *//* empty css                */import{u as Ge}from"./loading.f82ebe9b.js";import{_ as He}from"./index.vue_vue_type_script_setup_true_lang.7ecdc547.js";import{b as We}from"./replay.72c39936.js";import{_ as je}from"./index.vue_vue_type_script_setup_true_lang.e0cb0599.js";/* empty css                */import{g as Je}from"./module.bf6e4bd0.js";import{c as Qe}from"./task.f28b25f5.js";import{_ as Xe}from"./index.vue_vue_type_script_setup_true_lang.7a286740.js";import"./chart.42ea7243.js";import"./vue.4bab78c1.js";import"./base.3c7b4f95.js";const Ye={name:"TestCaseTree"},Ze=G({...Ye,emits:["onSelect"],setup(I,{emit:p}){const m=r(!0),n=X();let g=n.appName;const C=r(),E=r([]),d=()=>{n.appName&&Le(n.appName).then(o=>{C.value=o.data;const u=[];o.data[0]&&o.data[0].children&&o.data[0].children.forEach(b=>{u.push(b.key)}),u.push(0),E.value=u})};d();const _=(o,u)=>{if(o!=null&&o.leaf&&u.push(o==null?void 0:o.key),(o==null?void 0:o.children)&&(o==null?void 0:o.children.length)>0)for(let b=0;b<(o==null?void 0:o.children.length);++b){const T=o==null?void 0:o.children[b];_(T,u)}},B=r([]);let y=-1;const w=(o,u)=>{var R,x,q,M,A;const b=(R=u.node)==null?void 0:R.title,T=(x=u.node)==null?void 0:x.id,f=(q=u.node)==null?void 0:q.leaf,S=(M=u.node)==null?void 0:M.regression,$=[];_(u.node,$),B.value=$,p("onSelect",$,b,S,T),y=(A=u.node)==null?void 0:A.key,f?m.value=!0:m.value=!1};Y(()=>n.appName,o=>{g!==o&&(d(),g=o)},{deep:!0,immediate:!0});const D=r(!1),l=r(),c=j({name:"",radio:"task"}),N=async()=>{var u;return await((u=l.value)==null?void 0:u.validate())===void 0},U=()=>{let o=2;c.radio==="task"?o=2:o=1;const u={parentId:y,name:c.name,appName:n.appName,type:o};Ue(u).then(b=>{L.success("\u6DFB\u52A0\u6210\u529F"),d()})},h=()=>{J.warning({title:"\u5220\u9664\u786E\u8BA4",content:"\u5220\u9664\u52A8\u4F5C\u4E0D\u53EF\u9006\uFF0C\u8BF7\u786E\u8BA4\u4E4B\u540E\u518D\u64CD\u4F5C\uFF01",onOk:()=>{y!==-1&&Re(y).then(o=>{L.success("\u5220\u9664\u6210\u529F, \u5373\u5C06\u91CD\u65B0\u5237\u65B0\u6570\u636E"),d(),y=-1})}})};return(o,u)=>{const b=z("icon-plus"),T=me,f=z("icon-minus"),S=z("icon-play-circle"),$=z("icon-folder"),R=Ee,x=ue,q=ne,M=_e,A=se,H=Be,Z=De,ee=le,te=J,s=ie;return k(),V(s,{class:"general-card",title:"\u4EFB\u52A1\u5217\u8868"},{default:t(()=>[e(T,{type:"primary",size:"mini",disabled:m.value,onClick:u[0]||(u[0]=a=>D.value=!0)},{icon:t(()=>[e(b)]),_:1},8,["disabled"]),e(T,{type:"primary",size:"mini",style:{"margin-left":"5px"},onClick:h},{icon:t(()=>[e(f)]),_:1}),e(q,{style:{height:"100%","margin-top":"5px",border:"1px solid #ebedf1"}},{default:t(()=>[e(x,{span:24},{default:t(()=>[e(R,{"expanded-keys":E.value,"onUpdate:expandedKeys":u[1]||(u[1]=a=>E.value=a),data:C.value,size:"small","block-node":"",onSelect:w},{icon:t(a=>[a.node.leaf?(k(),V(S,{key:0,size:17,style:{color:"#4dbd42"}})):de("",!0),a.node.leaf?de("",!0):(k(),V($,{key:1,size:17,style:{color:"#b358e1"}}))]),_:1},8,["expanded-keys","data"])]),_:1})]),_:1}),e(te,{visible:D.value,"onUpdate:visible":u[4]||(u[4]=a=>D.value=a),"on-before-ok":N,title:"\u6DFB\u52A0\u4EFB\u52A1/\u76EE\u5F55",onOk:U},{default:t(()=>[e(ee,{ref_key:"formRef",ref:l,model:c,style:{width:"450px"},layout:"vertical"},{default:t(()=>[e(A,{field:"name",tooltip:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0/\u76EE\u5F55\u540D\u79F0",label:"\u4EFB\u52A1\u540D\u79F0/\u76EE\u5F55\u540D\u79F0",required:""},{default:t(()=>[e(M,{modelValue:c.name,"onUpdate:modelValue":u[2]||(u[2]=a=>c.name=a),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0/\u76EE\u5F55\u540D\u79F0"},null,8,["modelValue"])]),_:1}),e(A,{field:"radio",label:"Radio",required:""},{default:t(()=>[e(Z,{modelValue:c.radio,"onUpdate:modelValue":u[3]||(u[3]=a=>c.radio=a)},{default:t(()=>[e(H,{value:"task"},{default:t(()=>[v("\u4EFB\u52A1")]),_:1}),e(H,{value:"category"},{default:t(()=>[v("\u76EE\u5F55")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}});const et=oe(Ze,[["__scopeId","data-v-ad061349"]]),tt={key:1,style:{"font-weight":"900"}},at={key:2},ot={name:"CaseRecordMsg"},ut=G({...ot,props:{data:{type:Object,default(){return{}}}},setup(I){const p=I,m=r([{label:"Id",value:p.data.caseId,key:"caseId"},{label:"\u7528\u4F8B\u540D\u79F0",value:p.data.caseName,key:"caseName"},{label:"\u6D41\u91CF\u7C7B\u578B",value:p.data.recordType,key:"recordType"}]);return(n,g)=>{const C=he,E=Te;return k(),V(E,{data:m.value,size:"mini",column:1},{label:t(({label:d})=>[v(P(d),1)]),value:t(({value:d,data:_})=>[_.key==="caseId"?(k(),V(C,{key:0,color:"green",size:"small"},{default:t(()=>[v(P(d),1)]),_:2},1024)):_.key==="caseName"?(k(),Q("span",tt,P(d),1)):(k(),Q("span",at,P(d),1))]),_:1},8,["data"])}}}),nt={name:"TaskConsole"},st=G({...nt,props:{visible:{type:Boolean,default:!1,required:!0}},emits:["update:visible","ok"],setup(I,{emit:p}){const m=X(),n=j({env:"test",ip:"",date:new Date().getTime(),retryTime:3}),g=r(),C=()=>{if(n.ip===""){g.value.setFields({ip:{status:"error",message:"\u56DE\u653E\u673A\u5668\u5FC5\u9009"}});return}p("ok",n),p("update:visible",!1)},E=()=>{p("update:visible",!1)},d=r([]),_=()=>{m.appName&&Je(m.appName,n.env).then(l=>{d.value=l.data,l.data.length>0?n.ip=l.data[0].ip:(L.warning("\u8BE5\u73AF\u5883\u65E0\u53EF\u7528agent\uFF0C\u8BF7\u6CE8\u610F\u5B89\u5168"),n.ip="")})},B=l=>{n.date=l},y=()=>n.date?!0:(L.error("\u65E5\u671F\u5FC5\u9009"),!1),w=r(n.date),D=l=>{_()};return Y(()=>m.appName,(l,c)=>{l!==c&&_()},{deep:!0,immediate:!0}),(l,c)=>{const N=we,U=Ne,h=se,o=Ve,u=Ie,b=le,T=J;return k(),V(T,{visible:I.visible,onOk:C,onCancel:E,"on-before-ok":y},{title:t(()=>[v(" \u4EFB\u52A1\u63A7\u5236\u53F0 ")]),default:t(()=>[e(b,{ref_key:"formRef",ref:g,model:n,style:{width:"100%"}},{default:t(()=>[e(h,{field:"env",label:"\u73AF\u5883"},{default:t(()=>[e(U,{modelValue:n.env,"onUpdate:modelValue":c[0]||(c[0]=f=>n.env=f),placeholder:"Please select ...",onChange:D},{default:t(()=>[e(N,{value:"test",selected:""},{default:t(()=>[v("test")]),_:1}),e(N,{value:"dev"},{default:t(()=>[v("dev")]),_:1}),e(N,{value:"stg"},{default:t(()=>[v("stg")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(h,{field:"ip",label:"\u673A\u5668",rules:[{required:!0,message:"ip is required"}]},{default:t(()=>[e(U,{modelValue:n.ip,"onUpdate:modelValue":c[1]||(c[1]=f=>n.ip=f),placeholder:"Please select ..."},{default:t(()=>[(k(!0),Q(xe,null,Ae(d.value,f=>(k(),V(N,{key:f.ip,value:f.ip},{default:t(()=>[v(P(f.ip),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(h,{field:"date",label:"Date"},{default:t(()=>[e(o,{"value-format":"timestamp","show-time":"",defaultValue:w.value,onChange:B},null,8,["defaultValue"])]),_:1}),e(h,{field:"retryTime",label:"\u5931\u8D25\u91CD\u8BD5\u6B21\u6570"},{default:t(()=>[e(u,{modelValue:n.retryTime,"onUpdate:modelValue":c[2]||(c[2]=f=>n.retryTime=f),min:1,max:6},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),lt={name:"TestCaseTable"},it=G({...lt,props:{taskList:{type:Array,default(){return[]}},title:{type:String,default:"\u5168\u90E8\u7528\u4F8B"},rid:{type:String,default:"-1"}},setup(I){const p=I,m=r([]),n=r(!0),g=r(!1),C={x:document.body.clientWidth-400},E=Se(()=>`\u4EFB\u52A1\u540D\u79F0(${p.title})`),{loading:d,setLoading:_}=Ge(!0),B=X(),y=r([]),w=async(s={page:1,pageSize:20})=>{_(!0);try{const a={...s,appName:B.appName,taskList:p.taskList},{data:F,count:K}=await Pe(a);y.value=F,o.page=s.page,o.total=K}catch{}finally{_(!1)}},D=()=>({entranceDesc:"",traceId:"",requestId:"",environment:"test",createdTime:[],caseName:"",caseId:""}),l=r(D()),c=()=>{w({...h,...l.value})},N=()=>{l.value=D()},U=j({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1}),h={page:1,pageSize:20,showPageSize:!0},o=j({...h}),u=[{title:"\u57FA\u672C\u4FE1\u606F",slotName:"cai",width:300},{title:"\u4E3B\u8C03\u7528",dataIndex:"entranceDesc",slotName:"entranceDesc"},{title:"\u6DFB\u52A0\u4EBA",dataIndex:"user",width:100},{title:"\u6DFB\u52A0\u65F6\u95F4",dataIndex:"gmtCreate"},{title:"\u64CD\u4F5C",slotName:"buttons",fixed:"right",width:100}],b=s=>{w({...h,page:s})};Y(()=>p.title,(s,a)=>{s!==a&&c()},{deep:!0,immediate:!0});const T=s=>{const{href:a}=ce.resolve({path:`/test/case-detail/${s.appName}/${s.caseId}`});window.open(a,"_blank")},f=r(null),S=r(!1),$=s=>{f.value=s,S.value=!0},R=(s,a)=>{We(a.appName,a.caseId,s.ip).then(F=>{window.open(`/#/replay/detail/${a.appName}/${F.data}`)})};let x=[];const q=s=>{s.length>0?(n.value=!1,x=s):(n.value=!0,x=[])},M=()=>{J.warning({title:"\u5220\u9664\u786E\u8BA4",content:"\u5220\u9664\u52A8\u4F5C\u4E0D\u53EF\u9006\uFF0C\u8BF7\u786E\u8BA4\u4E4B\u540E\u518D\u64CD\u4F5C\uFF01",onOk:()=>{qe(x,void 0).then(()=>{L.success("\u5220\u9664\u6210\u529F"),c()})}})},A=r(!1),H=()=>{A.value=!0},Z=s=>{const a={gmtExec:s.date,appName:B.appName,name:`\u4E34\u65F6\u4EFB\u52A1[${p.title}]`,testTaskIdList:p.taskList,environment:s.env,ipList:[s.ip],retryTime:s.retryTime};Qe(a).then(F=>{L.success("\u6210\u529F");const{href:K}=ce.resolve({path:`/test/taskDetail/${F.data}`});window.open(K,"_blank")})},ee=()=>{g.value=!0},te=async s=>{await Me(s.taskId,x,B.appName),L.success("\u79FB\u52A8\u6210\u529F"),c(),m.value=[]};return(s,a)=>{const F=me,K=_e,W=se,O=ue,fe=$e,ae=ne,ve=le,re=Ke,ye=z("icon-search"),be=z("icon-refresh"),ge=Oe,Fe=ze,ke=ie;return k(),V(ke,{class:"general-card",title:pe(E)},{extra:t(()=>[e(F,{type:"text",status:"warning",onClick:H},{default:t(()=>[v("\u521B\u5EFA\u56DE\u653E\u4EFB\u52A1")]),_:1})]),default:t(()=>[e(ae,null,{default:t(()=>[e(O,{flex:1},{default:t(()=>[e(ve,{model:l.value,"label-col-props":{span:6},"wrapper-col-props":{span:18},"label-align":"left",layout:"inline"},{default:t(()=>[e(ae,{gutter:16},{default:t(()=>[e(O,{span:8},{default:t(()=>[e(W,{field:"number",label:"\u4E3B\u8C03\u7528"},{default:t(()=>[e(K,{modelValue:l.value.entranceDesc,"onUpdate:modelValue":a[0]||(a[0]=i=>l.value.entranceDesc=i),placeholder:"\u8F93\u5165\u4E3B\u8C03\u7528\u8FDB\u884C\u67E5\u8BE2"},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{span:8},{default:t(()=>[e(W,{field:"caseId",label:"\u7528\u4F8BId"},{default:t(()=>[e(K,{modelValue:l.value.caseId,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value.caseId=i),placeholder:"\u8BF7\u8F93\u5165\u7528\u4F8BId"},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{span:8},{default:t(()=>[e(W,{field:"caseName",label:"\u7528\u4F8B\u540D\u79F0"},{default:t(()=>[e(K,{modelValue:l.value.caseName,"onUpdate:modelValue":a[2]||(a[2]=i=>l.value.caseName=i),placeholder:"\u7528\u4F8B\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{span:8},{default:t(()=>[e(W,{field:"createdTime",label:s.$t("searchTable.form.createdTime")},{default:t(()=>[e(fe,{modelValue:l.value.createdTime,"onUpdate:modelValue":a[3]||(a[3]=i=>l.value.createdTime=i),style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(re,{style:{height:"84px"},direction:"vertical"}),e(O,{flex:"86px",style:{"text-align":"right"}},{default:t(()=>[e(ge,{direction:"vertical",size:18},{default:t(()=>[e(F,{type:"primary",onClick:c},{icon:t(()=>[e(ye)]),default:t(()=>[v(" \u67E5\u8BE2 ")]),_:1}),e(F,{onClick:N},{icon:t(()=>[e(be)]),default:t(()=>[v(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1}),e(re,{style:{"margin-top":"0","margin-bottom":"5px"}}),e(ae,{style:{width:"100%","margin-bottom":"5px"}},{default:t(()=>[e(O,{offset:20,span:4,style:{"text-align":"right"}},{default:t(()=>[e(F,{type:"primary",size:"mini",disabled:n.value,onClick:ee,style:{"margin-right":"5px"}},{default:t(()=>[v(" \u79FB\u52A8 ")]),_:1},8,["disabled"]),e(F,{type:"primary",status:"danger",size:"mini",disabled:n.value,onClick:M},{default:t(()=>[v(" \u5220\u9664 ")]),_:1},8,["disabled"])]),_:1})]),_:1}),e(Fe,{selectedKeys:m.value,"onUpdate:selectedKeys":a[4]||(a[4]=i=>m.value=i),"row-key":"caseId",columns:u,"row-selection":U,loading:pe(d),pagination:o,bordered:!1,data:y.value,size:"mini",scroll:C,onPageChange:b,onSelectionChange:q},{cai:t(({record:i})=>[e(ut,{data:i},null,8,["data"])]),entranceDesc:t(({record:i})=>[e(He,{"record-type":i.recordType,"entrance-desc":i.entranceDesc},null,8,["record-type","entrance-desc"])]),buttons:t(({record:i})=>[e(F,{type:"outline",size:"mini",shape:"round",style:{"margin-right":"5px"},onClick:Ce=>T(i)},{default:t(()=>[v(" \u8BE6\u60C5 ")]),_:2},1032,["onClick"]),e(F,{type:"outline",size:"mini",shape:"round",onClick:Ce=>$(i)},{default:t(()=>[v(" \u56DE\u653E ")]),_:2},1032,["onClick"])]),_:1},8,["selectedKeys","row-selection","loading","pagination","data"]),e(je,{visible:S.value,"onUpdate:visible":a[5]||(a[5]=i=>S.value=i),record:f.value,onOk:R},null,8,["visible","record"]),e(st,{visible:A.value,"onUpdate:visible":a[6]||(a[6]=i=>A.value=i),onOk:Z},null,8,["visible"]),e(Xe,{open:g.value,"onUpdate:open":a[7]||(a[7]=i=>g.value=i),onOk:te},null,8,["open"])]),_:1},8,["title"])}}});const rt=oe(it,[["__scopeId","data-v-491c625a"]]),ct={class:"container"},dt={name:"TestCase"},pt=G({...dt,setup(I){const p=X(),m=r(),n=r("\u5168\u90E8\u7528\u4F8B"),g=r("-1"),C=r(!1),E=(d,_,B,y)=>{m.value=d,n.value=_,g.value=y,C.value=B};return Y(()=>p.appName,(d,_)=>{d!==_&&(n.value="\u5168\u90E8\u7528\u4F8B",m.value=[])},{deep:!0,immediate:!0}),(d,_)=>{const B=z("Breadcrumb"),y=ue,w=ne,D=ie;return k(),Q("div",ct,[e(B,{items:["menu.manager.test","menu.manager.test.caseList"]},null,8,["items"]),e(D,{class:"general-card"},{default:t(()=>[e(w,null,{default:t(()=>[e(y,{span:5},{default:t(()=>[e(et,{onOnSelect:E})]),_:1}),e(y,{span:19},{default:t(()=>[e(rt,{title:n.value,"task-list":m.value,rid:g.value,regression:C.value},null,8,["title","task-list","rid","regression"])]),_:1})]),_:1})]),_:1})])}}});const Rt=oe(pt,[["__scopeId","data-v-5b7120b4"]]);export{Rt as default};
